<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="dropserver.css" rel="stylesheet">
        <title>DropServer.org Web Application Platform</title>
    </head>
    <body>
        <h1 class="dropserver-logo">
            <a href="index.html">
                dr<span class="drop-o">o</span>p<span class="s">server</span>
            </a>
        </h1>

        <h2>DropServer Application Model</h2>

        <p>DropServer is a fresh take on hosting applications for non-technical users. As such it is worth considering each aspect anew.</p>

        <h2>Goals</h2>

        <p>DropServer's goal is to allow individuals to host their own personal web-based applications and services in a safe and convenient way. This means:</p>

        <ul>
        <li>Security and Privacy: Minimize the damage a malicious app can do by using the principle of least privilege. See <a href="security-model.html">security model</a> for details.</li>

        <li>Convenience: Users should be able to "install" apps in a few clicks, and not be burdened with maintenance tasks.</li>

        <li>Simplicity: Assume users are not experts. Minimize configuration options and favor making safe decisions for them.</li>

        <li>Portability: Should they choose to move to a different host, or want to host under a different domain, an existing service should be transplantable with minimal fuss.</li>

        <li>Stability: While DropServer will evolve over time and its APIs will change, old applications should continue to work on the latest DropServer.</li>

        <li>Performance: Users may install many apps, but performance should be as good as possible on low power hardware. It also means responding quickly to requests to an appspace even if it is rarely used.</li>
        </ul>

        <h2>What is a "Cloud" Application?</h2>

        <p>We are all familiar with apps on our phones, and applications on our desktop based systems.</p>

        <p>In these systems, we typically use the OS's user interface to "launch" an application, or to bring it to the foreground, and then interact with the app using its UI.</p>

        <p>But what does it mean to have an application in the "cloud"?</p>

        <p>Web-based things are not usually "launched" by the user, instead they are "accessed". This implies that they have a location: an address ("URL") the user can enter into an address bar.</p>

        <p>Instead of installing an application that the user can start and use as needed, the user creates an address and specifies the app that runs there.</p>

        <p>On the desktop a user typically chooses which files to edit in the application using the OS's file picker. This does not map well with the way web services typically work. Therefore an instance of an application will be tied to a data directory.</p>

        <p>An application instance therefore specifies:</p>

        <ul>
            <li>An address, like myservice.example.com</li>
            <li>Application code</li>
            <li>A data directory</li>
        </ul>

        <p>In DropServer this trio is called an Appspace.</p>

        <p>Beyond this there are a few concepts:</p>

        <h3>Appspace Address</h3>
        <p>An appspace's address is a domain, optionally with subdomains: "myapp.mypersonalsite.name" for example.</p>
        <p>The address must be a unique domain and subdomain combination to ensure cookies for one appspace can't be used for an other.</p>

        <h3>Application Code</h3>
        <p>Each appspace is run by a single application at a given version.</p>

        <p>Application code consists of one or more files, including JavaScript code that runs in response to inbound requests (see sandbox in security model), frontend code files, assets, data files, and anything else that is needed.</p>
        
        <p>Applications can be uploaded from the users computer, or acquired via a URL (roadmap feature).</p>

        <h3>Appspace Data Directory</h3>
        <p>Each appspace gets exclusive read and write access to a directory on the system. No other appspace has read or write access there.</p>
        
        <p>This directory is created when the appspace is initialized and is used to store data in files.</p>

        <p>Files in the appspace's data directory can be served statically via specially crafted routes (see below).</p>

        <p>The size of the directory can be monitored and restricted (roadmap feature).</p>

        
        <h3>Appspace Schema And Data Migrations</h3>

        <p>The application is responsible for the appspace's data directory structure, as well as the schema of the databases within it.</p>

        <p>An application specifies the version of the schema that it works with. Each new version of the application can specify the same schema until it needs to make a change to the structure of the files and/or databases within it (such as to accommodate a new feature).</p>

        <p>When a migration is needed the application specifies a new schema, and it also includes code that can migrate a data directory from the previous schema to this new one, as well as perform the reverse operation.</p>

        <p>Dropserver runs migrations as needed when a new version of the application is used by an appspace, and upon initialization of an appspace.</p>

        <h3>Appspace Data Backup and Import/Export</h3>

        <p>Dropserver can stop an appspace temporarily and take a "snapshot" of an appspace (basically a copy of the data directory plus some metadata). This can be used to backup an appspace.</p>

        <p>The exported data contains enough data to recreate the appspace on a different Dropserver host. If proper app coding practices are followed (tbd) it should be possible to move an appspace to a new host and a new domain with no issues.</p>

        <p>Finally it's also possible to run an exported appspace locally on a desktop. This can be useful for debugging an app (see ds-dev), or simply because it's a convenient way of accessing an appspace that is no longer online.</p>

        <h3>Appspace Availability</h3>

        <p>To ensure consistent backups, Dropserver stops the appspace before performing a backup. "Stopping" an appspace means waiting for all http requests to finish, and for all connections to databases to close cleanly.New HTTP requests get a 503 response during this period. Once the backup is finished the appspace resumes normal operation.</p>
        
        <p>An appspace owner can also manually cause the appspace to become available by hitting the "Pause" button in the UI.</p>

        <p>Furthermore, Dropserver will make an appspace unavailable if it detects an anomaly in the appspace (such as the wrong data schema). These measures are intended to forestall data corruption.</p>
        
        <h3>Appspace Users</h3>

        <p>When a DropServer user creates an appspace, they are automatically added as a user of that appspace. For single-user apps, that's the end of the story. But cloud apps are more fun and useful when family, friends,  and collaborators are there too.</p>

        <p>Some apps can benefit from being more open to outsiders. Consider for example an appspace that provides commenting capabilities for a blog. In those cases, the appspace owner can make registration "open". This means that someone can add themselves to the appspace by submitting their DropServer URL and username and authenticating. (Roadmap feature, details TBD.)</p>

        <p>The appspace owner can add a friend to the appspace using their email (roadmap), or using something called a DropID.</p>
        
        <p>A DropID is essentially a link to the friend's own Dropserver instance. With a DropID, the friend can log in to the user's appspace simply by logging in to their own Dropserver.</p>

        <p>To log in with an email, the user would enter their email to receive a special link that would log them in. (Roadmap feature.)</p>

        <h3>Application Routes</h3>

        <p>Routes are created in app code, but unlike most JS server apps, these routes are not stored in the running application's memory. Instead they are written to a database on the DropServer host. This allows Dropserver to clear an appspace's runtime stack and shut down its sandbox when it is not used.</p>

        <p>Routes are declared by specifying the relevant http methods and the path, an authorization scheme (see below), and a route handler.</p>

        <p>Route handlers can be:</p>
        <ul>
            <li>Call function: start a sandbox if necessary and call this function which will handle the reply.</li>
            <li>Static serve: a static file server that can map to an appspace directory or an app directory.</li>
        </ul>

        <p>DropServer can respond to static routes without starting the sandbox. This helps appspaces feel responsive and conserve resources.</p>

        <p>There are two ways to create routes: by the app when it is installed, and dynamically during regular appspace use (the latter is a roadmap feature).</p>
        
        <h3>Route Authorization</h3>

        <p>Routes can be:</p>

        <ul>
            <li>Authorized: a visitor must be authorized to access the route by authenticating as an authorized user or with an API key (API key is a roadmap feature.)</li>
            <li>Public: no authentication or authorization needed.</li>
        </ul>

        <p>Users can authenticate using their own DropServer account, regardless of where it is hosted.</p>

        <p>In addition, there is a concept of permissions: apps can specify permissions that can be required to access certain routes. It works like this:</p>

        <ol>
            <li>App code specifies a list of permissions (like "view", "create").</li>
            <li>Routes with the "Authorized" scheme can require that a permission be held (accessing /create requires the "create" permission).</li>
            <li>Users and API keys can be associated with permission in the user management interface (see below).</li>
        </ol>

        <h3>Timed Function Calls</h3>

        <p>In addition to responding to http requests app functions can be called in a <a href="https://en.wikipedia.org/wiki/Cron">cron</a>-like fashion. (Roadmap feature.)</p>

        <h3>DropServer API Version</h3>

        <p>All touch points between Dropserver and external code and data (apps, appspace data, etc..) are considered part of the Dropserver API. This API is versioned. When future versions of DS are released with changing APIs, the version will be incremented.</p>

        <p>Incrementing the DS API version does not mean that the earlier versions are no longer supported. The goal is to continue to maintain the older APIs at their original version as much as possible.</p>

        <p>This should enable people to upgrade to the latest version of DS without abandoning their old, outdated apps.</p>

        <h3>Resource Utilization</h3>
        
        <p>Resources used by each appspace are tracked, including CPU time, disk usage, memory used when running, etc...</p>

        <p>This is all a big roadmap meta-feature.</p>
        
        <footer>
            &copy; <a href="olivierforget.net">Olivier Forget</a>
        </footer>

    </body>
</html>